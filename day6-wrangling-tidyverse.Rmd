---
title: "Data wrangling in tidyr"
author: "Michelle Lam"
date: "2022-08-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(tidyverse)
library(here)
library(janitor)
```


## Read in WB data files

```{r}
# Read in wb_indicators.csv file and convert the missing values using the na function
wb_indicators <- read_csv(here("data", "wb_indicators.csv"), na = c("..", ""))

# Read in metadata
wb_metadata <- read_csv(here("data", "wb_indicators_metadata.csv"))
```

## Tidy up my data

### pivot_longer to get years into a single column

```{r}
wb_indicators_long <- wb_indicators |> 
  pivot_longer(cols = '2001 [YR2001]':'2020 [YR2020]',
               names_to = "year",
               values_to = "indicator_value")
```

### separate to clean up the year column

```{r}
wb_clean <- wb_indicators_long |> 
  separate(col = year, into = c("year", "year_chr"), sep = " ") |> 
  select(-year_chr, -'Country Code', -'Series Code') |> 
  mutate(year = as.numeric(year)) |> 
  drop_na('Series Name') |> 
  pivot_wider(names_from = 'Series Name',
              values_from = 'indicator_value')

# can also create a new column with the mutate function by specifying new column name
# drop_na remove rows where series name is NA
# use unique() to see unique values in column 
# Widen the variables currently trapped in 'Series Name' to be spread across multiple columns, and get the values that populated the columns from 'indicator_value'

# rename columns with names() function, not a pipe-able function
names(wb_clean) <- c("country", "year", "access_clean_fuels_pp", "access_electricity_pp", "co2_emissions_kt", "fossil_fuel_cons_pct", "water_stress")

# rename columns using the rename() function
wb_clean_2 <- wb_clean |> 
  rename(my_year = year)

# filter by subset of countries
wb_subset <- wb_clean |> 
  filter(country %in% c("Algeria", "Barbados", "Bulgaria", "Chile"))

# create graph
ggplot(data = wb_subset, aes(x = year, y = co2_emissions_kt)) +
  geom_line(aes(color = country)) +
  facet_wrap(~country)
```

